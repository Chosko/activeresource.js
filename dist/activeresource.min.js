/*
	ActiveResource.js 0.9.0
	(c) 2016 Nick Landgrebe && Peak Labs, LLC DBA Occasion App
	ActiveResource.js may be freely distributed under the MIT license
	Portions of ActiveResource.js were inspired by or borrowed from Rail's ActiveRecord library
*/
!function(root,factory){"function"==typeof define&&define.amd?define(["jquery","underscore","underscore.string","underscore.inflection"],factory):"object"==typeof exports?(require("underscore.inflection"),module.exports=factory(require("jquery"),require("underscore"),require("underscore.string"))):root.ActiveResource=factory(root.jQuery,root._,root.s)}(this,function(jQuery,_,s){var ActiveResource=function(){};return function(){!function(moduleHandler){return moduleHandler.constantize=function(className){var klass;if(null==(klass=ActiveResource.constantizeScope[className]))throw"NameError: klass "+className+" does not exist";return klass},moduleHandler.extend=function(klass,mixin){var method,name,_results;_results=[];for(name in mixin)method=mixin[name],method.__excludeFromExtend?_results.push(void 0):_results.push(klass[name]=method);return _results},moduleHandler.include=function(klass,mixin){return this.extend(klass.prototype,mixin)}}(ActiveResource)}.call(this),function(){ActiveResource.prototype.Typing=function(){function Typing(){}return Typing.klass=function(){return this.constructor},Typing.isA=function(klass){var match,object;for(object=this,match=object.constructor===klass;!match&&null!=(object=object.constructor.__super__);)match=object.constructor===klass;return match},Typing}()}.call(this),function(){ActiveResource.prototype.Interfaces=function(){function Interfaces(){}return Interfaces.prototype.Base=function(){function Base(){}return Base.request=function(url,method,data){var options;return options={contentType:"application/json",dataType:"json",headers:ActiveResource.headers,method:method,url:url},options.data="GET"===method?data:JSON.stringify(data),jQuery.ajax(options)},Base.get=function(url,queryParams){throw"#get not implemented on base interface"},Base.post=function(url,resourceData,options){throw"#post not implemented on base interface"},Base.patch=function(url,resourceData,options){throw"#patch not implemented on base interface"},Base.put=function(url,resourceData,options){throw"#put not implemented on base interface"},Base["delete"]=function(url,resourceData,options){throw"#delete not implemented on base interface"},Base}(),Interfaces}.call(this)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Interfaces.prototype.JsonApi=function(_super){function JsonApi(){return _ref=JsonApi.__super__.constructor.apply(this,arguments)}var addErrorsFromPersistenceAttempt,addRelationshipsToAttributes,buildIncludeTree,buildResource,buildResourceDocument,buildResourceIdentifier,buildResourceRelationships,buildSortList,buildSparseFieldset,findIncludeFromRelationship,mergePersistedChanges,toCamelCase,toUnderscored;return __extends(JsonApi,_super),JsonApi.request=function(url,method,data){return JsonApi.__super__.constructor.request.apply(this,arguments).then(function(response,textStatus,xhr){if(null==(null!=response?response.data:void 0)&&204!==xhr.status)throw"Response from "+url+" was not in JSON API format";return response})},toUnderscored=function(object){var k,underscored,v;underscored={};for(k in object)v=object[k],underscored[s.underscored(k)]=_.isArray(v)?_.map(v,function(i){return toUnderscored(i)}):!_.isObject(v)||("function"==typeof v.isA?v.isA(ActiveResource.prototype.Base):void 0)||("function"==typeof v.isA?v.isA(ActiveResource.prototype.Collection):void 0)?v:toUnderscored(v);return underscored},toCamelCase=function(object){var camelized,k,v;camelized={};for(k in object)v=object[k],camelized[s.camelize(k)]=_.isArray(v)?_.map(v,function(i){return toCamelCase(i)}):!_.isObject(v)||("function"==typeof v.isA?v.isA(ActiveResource.prototype.Base):void 0)||("function"==typeof v.isA?v.isA(ActiveResource.prototype.Collection):void 0)?v:toCamelCase(v);return camelized},buildSparseFieldset=function(fields){return _.mapObject(fields,function(fieldArray){return _.map(fieldArray,function(f){return s.underscored(f)}).join()})},buildIncludeTree=function(includes){var buildNestedIncludes;return buildNestedIncludes=function(object){var includeCollection,modelName,value;return modelName=s.underscored(_.keys(object)[0]),value=_.values(object)[0],includeCollection=ActiveResource.prototype.Collection.build([value]).flatten().map(function(item){return _.isString(item)?_.map(item.split(","),function(i){return s.underscored(i)}):_.isObject(item)?buildNestedIncludes(item):void 0}).flatten(),includeCollection.map(function(i){return""+modelName+"."+i}).toArray()},ActiveResource.prototype.Collection.build(includes).inject([],function(includeStrArray,include){return _.isObject(include)?(includeStrArray.push.apply(includeStrArray,buildNestedIncludes(include)),includeStrArray):(includeStrArray.push(s.underscored(include)),includeStrArray)}).join()},buildSortList=function(sortObject){var column,dir,output;output=[];for(column in sortObject)dir=sortObject[column],"asc"===dir?output.push(s.underscored(column)):"desc"===dir&&output.push("-"+s.underscored(column));return output.join(",")},buildResourceIdentifier=function(resource){var identifier,primaryKeyValue;return identifier={type:resource.klass().queryName},(primaryKeyValue=resource[resource.klass().primaryKey])&&(identifier[resource.klass().primaryKey]=primaryKeyValue),identifier},buildResourceRelationships=function(resource){var autosaveReflections,relationships;return relationships={},autosaveReflections=resource.klass().reflectOnAllAutosaveAssociations(),resource.klass().reflectOnAllAssociations().each(function(reflection){var autosaving,output,target;if(autosaving=autosaveReflections.include(reflection),reflection.collection()){if(!resource.association(reflection.name).empty())return relationships[s.underscored(reflection.name)]={data:resource.association(reflection.name).reader().all({cached:!0}).map(function(target){var output;return output=buildResourceIdentifier(target),autosaving&&(output.attributes=_.omit(target.attributes(),resource.klass().primaryKey)),output}).toArray()}}else if(null!=resource.association(reflection.name).reader())return target=resource.association(reflection.name).reader(),output=buildResourceIdentifier(target),autosaving&&(output.attributes=_.omit(target.attributes(),resource.klass().primaryKey)),relationships[s.underscored(reflection.name)]={data:output}}),relationships},buildResourceDocument=function(resourceData,onlyResourceIdentifiers){var data;return null==onlyResourceIdentifiers&&(onlyResourceIdentifiers=!1),data=ActiveResource.prototype.Collection.build(resourceData).compact().map(function(resource){var documentResource;return documentResource=buildResourceIdentifier(resource),onlyResourceIdentifiers||(documentResource.attributes=toUnderscored(_.omit(resource.attributes(),resource.klass().primaryKey)),documentResource.relationships=buildResourceRelationships(resource)),documentResource}),_.isArray(resourceData)?data.toArray():data.first()},buildResource=function(data,includes,existingResource){var attributes,resource;return resource=existingResource||ActiveResource.constantize(_.singularize(s.classify(data.type))).build(),"id"===resource.klass().primaryKey&&(data.id=parseInt(data.id)),attributes=_.extend(_.omit(data,"type","attributes","links","relationships"),data.attributes),attributes=addRelationshipsToAttributes(attributes,data.relationships,includes,resource),resource.assignAttributes(toCamelCase(attributes)),resource.__links=_.pick(data.links,"self"),resource.klass().reflectOnAllAssociations().each(function(reflection){var association,relationship,relationshipEmpty,_ref1,_ref2,_ref3,_ref4;return association=resource.association(reflection.name),association.__links=null!=(_ref1=data.relationships)&&null!=(_ref2=_ref1[s.underscored(reflection.name)])?_ref2.links:void 0,relationshipEmpty=_.isObject(relationship=null!=(_ref3=data.relationships)&&null!=(_ref4=_ref3[s.underscored(reflection.name)])?_ref4.data:void 0)?0===_.keys(relationship).length:null!=relationship?0===relationship.length:!0,_.has(attributes,reflection.name)||relationshipEmpty?association.loaded(!0):void 0}),resource},addRelationshipsToAttributes=function(attributes,relationships,includes,resource){return _.each(relationships,function(relationship,relationshipName){var include,relationshipItems;if(_.isArray(relationship.data)){if(relationshipItems=ActiveResource.prototype.Collection.build(relationship.data).map(function(relationshipMember){return findIncludeFromRelationship(relationshipMember,includes,resource)}).compact(),!("function"==typeof relationshipItems.empty?relationshipItems.empty():void 0))return attributes[relationshipName]=relationshipItems}else if(null!=relationship.data&&(include=findIncludeFromRelationship(relationship.data,includes,resource),null!=include))return attributes[relationshipName]=include}),attributes},findIncludeFromRelationship=function(relationshipData,includes,resource){var findConditions,include;return findConditions={type:relationshipData.type},findConditions[resource.klass().primaryKey]=relationshipData[resource.klass().primaryKey],null!=(include=_.findWhere(includes,findConditions))&&(include=buildResource(include,includes)),include},mergePersistedChanges=function(response,resource){return buildResource(response.data,response.included,resource)},addErrorsFromPersistenceAttempt=function(errors,resource){return _.each(errors,function(error){return resource.errors().add(s.camelize(error.field)||"base",s.camelize(error.key),error.message)}),resource},JsonApi.get=function(url,queryParams){var data;return null==queryParams&&(queryParams={}),data={},null!=queryParams.filter&&(data.filter=toUnderscored(queryParams.filter)),null!=queryParams.fields&&(data.fields=buildSparseFieldset(queryParams.fields)),null!=queryParams.include&&(data.include=buildIncludeTree(queryParams.include)),null!=queryParams.sort&&(data.sort=buildSortList(queryParams.sort)),null!=queryParams.page&&(data.page=queryParams.page),this.request(url,"GET",data).then(function(response){var built;return built=ActiveResource.prototype.Collection.build(_.flatten([response.data])).map(function(object){return object=buildResource(object,response.included),object.__queryOptions=_.pick(queryParams,"include","fields"),object}),_.isArray(response.data)?built:built.first()},function(errors){return ActiveResource.prototype.Collection.build(errors.responseJSON).map(function(error){return error.field=s.camelize(error.field),error.key=s.camelize(error.key),error})})},JsonApi.post=function(url,resourceData,options){var data;return null==options&&(options={}),data={data:buildResourceDocument(resourceData,options.onlyResourceIdentifiers)},options.onlyResourceIdentifiers||(data=_.extend(data,ActiveResource.prototype.Collection.build(resourceData).first().__queryOptions)),this.request(url,"POST",data).then(function(response){return options.onlyResourceIdentifiers?response:mergePersistedChanges(response,resourceData)},function(errors){return options.onlyResourceIdentifiers?errors:addErrorsFromPersistenceAttempt(errors.responseJSON,resourceData)})},JsonApi.patch=function(url,resourceData,options){var data;return null==options&&(options={}),data={data:buildResourceDocument(resourceData,options.onlyResourceIdentifiers)},options.onlyResourceIdentifiers||(data=_.extend(data,ActiveResource.prototype.Collection.build(resourceData).first().__queryOptions)),this.request(url,"PATCH",data).then(function(response){return options.onlyResourceIdentifiers?response:mergePersistedChanges(response,resourceData)},function(errors){return options.onlyResourceIdentifiers?errors:addErrorsFromPersistenceAttempt(errors.responseJSON,resourceData)})},JsonApi.put=function(url,resourceData,options){var data;return null==options&&(options={}),data={data:buildResourceDocument(resourceData,options.onlyResourceIdentifiers)},options.onlyResourceIdentifiers||(data=_.extend(data,ActiveResource.prototype.Collection.build(resourceData).first().__queryOptions)),this.request(url,"PUT",data).then(function(response){return options.onlyResourceIdentifiers?response:mergePersistedChanges(response,resourceData)},function(errors){return options.onlyResourceIdentifiers?errors:addErrorsFromPersistenceAttempt(errors.responseJSON,resourceData)})},JsonApi["delete"]=function(url,resourceData,options){var data;return null==options&&(options={}),data=null!=resourceData?{data:buildResourceDocument(resourceData,!0)}:{},this.request(url,"DELETE",data)},JsonApi}(ActiveResource.prototype.Interfaces.prototype.Base)}.call(this),function(){ActiveResource.prototype.Associations=function(){function Associations(){}return Associations.prototype.association=function(name){var association,reflection;if(this.__associations||(this.__associations={}),null==(association=this.__associations[name])){if(null==(reflection=this.klass().reflectOnAssociation(name)))throw"Association "+name+" does not exist";association=new(reflection.associationClass())(this,reflection),this.__associations[name]=association}return association},Associations.hasMany=function(name,options){var reflection;return null==options&&(options={}),reflection=ActiveResource.prototype.Associations.prototype.Builder.prototype.HasMany.build(this,name,options),ActiveResource.prototype.Reflection.addReflection(this,name,reflection)},Associations.hasOne=function(name,options){var reflection;return null==options&&(options={}),reflection=ActiveResource.prototype.Associations.prototype.Builder.prototype.HasOne.build(this,name,options),ActiveResource.prototype.Reflection.addReflection(this,name,reflection)},Associations.belongsTo=function(name,options){var reflection;return null==options&&(options={}),reflection=ActiveResource.prototype.Associations.prototype.Builder.prototype.BelongsTo.build(this,name,options),ActiveResource.prototype.Reflection.addReflection(this,name,reflection)},Associations}()}.call(this),function(){ActiveResource.prototype.Attributes=function(){function Attributes(){}return Attributes.hasAttribute=function(attribute){return null!=this.__readAttribute(attribute)},Attributes.assignAttributes=function(attributes){var k,v,_base;for(k in attributes){v=attributes[k];try{("function"==typeof(_base=this.association(k).reflection).collection?_base.collection():void 0)?this[k]().assign(v,!1):this["assign"+s.capitalize(k)](v)}catch(_error){this[k]=v}}return null},Attributes.attributes=function(){var k,output,reserved,v,validOutput;reserved=["__associations","__errors","__links","__queryOptions"],validOutput=function(k,v){var e;return!_.isFunction(v)&&!_.contains(reserved,k)&&function(){try{return null==this.association(k)}catch(_error){return e=_error,!0}}.call(this)},output={};for(k in this)v=this[k],validOutput(k,v)&&(output[k]=v);return output},Attributes.reload=function(){var resource;if(!this.persisted())throw"Cannot reload a resource that is not persisted";return resource=this,ActiveResource["interface"].get(this.links().self,this.__queryOptions).then(function(reloaded){return resource.assignAttributes(reloaded.attributes()),resource.klass().reflectOnAllAssociations().each(function(reflection){var target;return target=reloaded.association(reflection.name).reader(),("function"==typeof reflection.collection?reflection.collection():void 0)&&(target=target.toArray()),resource.association(reflection.name).writer(target,!1)})})},Attributes.__readAttribute=function(attribute){return this.attributes()[attribute]},Attributes}()}.call(this),function(){var __slice=[].slice;ActiveResource.prototype.Collection=function(){function Collection(__collection){this.__collection=null!=__collection?__collection:[]}return ActiveResource.include(Collection,ActiveResource.prototype.Typing),Collection.build=function(array){return null==array&&(array=[]),("function"==typeof array.isA?array.isA(this):void 0)?array:new this(null!=array.length?array:[array])},Collection.prototype.size=function(){return _.size(this.__collection)},Collection.prototype.empty=function(){return 0===this.size()},Collection.prototype.include=function(item){return _.indexOf(this.__collection,item)>=0},Collection.prototype.get=function(index){return index>=this.size()?void 0:this.__collection[index]},Collection.prototype.set=function(index,item){return index>=this.size()?void 0:this.__collection[index]=item},Collection.prototype.toArray=function(){return this.__collection},Collection.prototype.all=function(){return this.toArray()},Collection.prototype.first=function(n){var output;return output=_.first(this.__collection,n||1),n?output:output[0]},Collection.prototype.last=function(n){var output;return output=_.last(this.__collection,n||1),n?output:output[0]},Collection.prototype.each=function(iteratee){return _.each(this.__collection,iteratee)},Collection.prototype.inject=function(memo,iteratee){return _.reduce(this.__collection,iteratee,memo)},Collection.prototype.map=function(iteratee){return ActiveResource.prototype.Collection.build(_.map(this.__collection,iteratee))},Collection.prototype.compact=function(iteratee){return ActiveResource.prototype.Collection.build(_.without(this.__collection,null,void 0))},Collection.prototype.join=function(separator){return null==separator&&(separator=","),s.join.apply(s,[separator].concat(__slice.call(_.map(this.__collection,function(i){return i.toString()}))))},Collection.prototype.flatten=function(){return ActiveResource.prototype.Collection.build(_.flatten(this.__collection))},Collection.prototype.push=function(){var objs,_ref;return objs=1<=arguments.length?__slice.call(arguments,0):[],(_ref=this.__collection).push.apply(_ref,objs)},Collection.prototype["delete"]=function(){var deleted,items;return items=1<=arguments.length?__slice.call(arguments,0):[],deleted=_.intersection(this.__collection,items),this.__collection=_.without.apply(_,[this.__collection].concat(__slice.call(items))),deleted},Collection.prototype.clear=function(){return this.__collection=[]},Collection.prototype.select=function(predicate){return ActiveResource.prototype.Collection.build(_.filter(this.__collection,predicate))},Collection.prototype.detect=function(predicate){return _.detect(this.__collection,predicate)},Collection}()}.call(this),function(){!function(config){return config.baseUrl=null,config.headers={},config.constantizeScope=window,config["interface"]=ActiveResource.prototype.Interfaces.prototype.JsonApi}(ActiveResource)}.call(this),function(){ActiveResource.prototype.Errors=function(){function Errors(base){this.base=base,this.reset()}return Errors.errors=function(){return this.__errors||(this.__errors=new ActiveResource.prototype.Errors(this))},Errors.valid=function(){return this.errors().empty()},Errors.prototype.reset=function(){return this.__errors={}},Errors.prototype.add=function(attribute,code,message){var error,_base;return null==message&&(message=""),(_base=this.__errors)[attribute]||(_base[attribute]=[]),this.__errors[attribute].push(error={code:code,message:message}),error},Errors.prototype.empty=function(){var empty,k,v,_ref;empty=!0,_ref=this.__errors;for(k in _ref)v=_ref[k],empty=empty&&!v.length;return empty},Errors.prototype.forAttribute=function(attribute){return ActiveResource.prototype.Collection.build(this.__errors[attribute]).inject({},function(out,error){return out[error.code]=error.message,out})},Errors.prototype.forBase=function(){return this.forAttribute("base")},Errors}()}.call(this),function(){ActiveResource.prototype.Persistence=function(){function Persistence(){}return Persistence.persisted=function(){return null!=this.links().self},Persistence.newResource=function(){return!this.persisted()},Persistence.save=function(callback){return this.__createOrUpdate().always(callback)},Persistence.update=function(attributes,callback){var oldAttributes;return oldAttributes=_.pick(this.attributes(),_.keys(attributes)),this.assignAttributes(attributes),this.__createOrUpdate().then(null,function(resource){return resource.assignAttributes(oldAttributes),resource}).always(callback)},Persistence.destroy=function(){var resource;return ActiveResource["interface"]["delete"](this.links().self,resource=this).then(function(){return resource.__links={},resource})},Persistence.__createOrUpdate=function(){return this.errors().reset(),this.persisted()?ActiveResource["interface"].put(this.links().self,this):ActiveResource["interface"].post(this.links().related,this)},Persistence}()}.call(this),function(){var __slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Reflection=function(){function Reflection(){}var _ref,_ref1,_ref2;return Reflection.prototype.reflections=function(){return this.__reflections||(this.__reflections={})},Reflection.prototype.reflectOnAllAssociations=function(macro){var reflections;return null==macro&&(macro=null),reflections=ActiveResource.prototype.Collection.build(_.values(this.__reflections)),macro&&(reflections=reflections.select(function(r){return r.macro===macro})),reflections},Reflection.prototype.reflectOnAssociation=function(association){return this.reflections()[association]},Reflection.prototype.reflectOnAllAutosaveAssociations=function(){var reflections;return reflections=ActiveResource.prototype.Collection.build(_.values(this.__reflections)),reflections.select(function(r){return r.options.autosave})},Reflection.create=function(macro,name,options,activeResource){var klass;return new(klass=function(){switch(macro){case"hasMany":return Reflection.prototype.HasManyReflection;case"hasOne":return Reflection.prototype.HasOneReflection;case"belongsTo":return Reflection.prototype.BelongsToReflection}}())(name,options,activeResource)},Reflection.addReflection=function(ar,name,reflection){var r;return r={},r[name]=reflection,ar.__reflections=_.extend(ar.__reflections||{},r)},Reflection.prototype.AbstractReflection=function(){function AbstractReflection(name,options,activeResource){this.name=name,this.options=options,this.activeResource=activeResource}var INVALID_AUTOMATIC_INVERSE_OPTIONS,VALID_AUTOMATIC_INVERSE_MACROS,automaticInverseOf,canFindInverseOfAutomatically,validInverseReflection;return ActiveResource.include(AbstractReflection,ActiveResource.prototype.Typing),AbstractReflection.__excludeFromExtend=!0,AbstractReflection.prototype.klass=function(){return ActiveResource.constantize(this.className())},AbstractReflection.prototype.type=function(){return this.__type||(this.__type=this.options.as&&(this.options.foreignType||""+this.options.as+"Type"))},AbstractReflection.prototype.className=function(){return this.__className||(this.__className=this.options.className||this.__deriveClassName())},AbstractReflection.prototype.foreignKey=function(){return this.__foreignKey||(this.__foreignKey=this.options.foreignKey||this.__deriveForeignKey())},AbstractReflection.prototype.foreignType=function(){return this.__foreignType||(this.__foreignType=this.options.foreignType||""+this.name+"Type")},AbstractReflection.prototype.associationPrimaryKey=function(klass){return this.options.primaryKey||this.__primaryKey(klass||this.klass())},AbstractReflection.prototype.activeResourcePrimaryKey=function(){return this.__activeResourcePrimaryKey||(this.__activeResourcePrimaryKey=this.options.primaryKey||this.__primaryKey(this.activeResource))},AbstractReflection.prototype.collection=function(){return!1},AbstractReflection.prototype.hasOne=function(){return!1},AbstractReflection.prototype.belongsTo=function(){return!1},AbstractReflection.prototype.constructable=function(){return!0},AbstractReflection.prototype.polymorphic=function(){return this.options.polymorphic},AbstractReflection.prototype.buildAssociation=function(){return new(this.klass())},AbstractReflection.prototype.hasInverse=function(){return null!=this.__inverseName()},AbstractReflection.prototype.inverseOf=function(){return this.hasInverse()?this.__inverseOf||(this.__inverseOf=this.klass().reflectOnAssociation(this.__inverseName())):void 0},AbstractReflection.prototype.polymorphicInverseOf=function(associatedClass){var inverseRelationship;return this.hasInverse()&&(inverseRelationship=associatedClass.reflectOnAssociation(this.options.inverseOf))?inverseRelationship:void 0},AbstractReflection.prototype.__deriveClassName=function(){return s.classify(_.singularize(this.name))},AbstractReflection.prototype.__deriveForeignKey=function(){return this.belongsTo()?""+this.name+"Id":this.options.as?""+this.options.as+"Id":""+s.camelize(this.activeResource.className,!0)+"Id"},AbstractReflection.prototype.__primaryKey=function(klass){return klass.primaryKey||function(){throw"Unknown primary key for "+klass.className}()},AbstractReflection.prototype.__inverseName=function(){return this.options.inverseOf||(this.__automaticInverseOf===!1?null:this.__automaticInverseOf||(this.__automaticInverseOf=automaticInverseOf(this)))},automaticInverseOf=function(reflection){var e,inverseName,inverseReflection;if(canFindInverseOfAutomatically(reflection)){inverseName=s.camelize(reflection.options.as||reflection.activeResource.className,!0);try{inverseReflection=reflection.klass().reflectOnAssociation(inverseName)}catch(_error){e=_error,inverseReflection=!1}if(validInverseReflection(reflection,inverseReflection))return inverseName}return!1},VALID_AUTOMATIC_INVERSE_MACROS=["hasMany","hasOne","belongsTo"],INVALID_AUTOMATIC_INVERSE_OPTIONS=["polymorphic"],canFindInverseOfAutomatically=function(reflection){return reflection.options.inverseOf!==!1&&_.include(VALID_AUTOMATIC_INVERSE_MACROS,reflection.macro)&&_.isEmpty(_.pick.apply(_,[reflection.options].concat(__slice.call(INVALID_AUTOMATIC_INVERSE_OPTIONS))))},validInverseReflection=function(reflection,inverseReflection){return null!=inverseReflection&&reflection.klass().className===inverseReflection.activeResource.className&&canFindInverseOfAutomatically(inverseReflection)},AbstractReflection}(),Reflection.prototype.HasManyReflection=function(_super){function HasManyReflection(){return _ref=HasManyReflection.__super__.constructor.apply(this,arguments)}return __extends(HasManyReflection,_super),HasManyReflection.__excludeFromExtend=!0,HasManyReflection.prototype.macro="hasMany",HasManyReflection.prototype.collection=function(){return!0},HasManyReflection.prototype.associationClass=function(){return ActiveResource.prototype.Associations.prototype.HasManyAssociation},HasManyReflection}(Reflection.prototype.AbstractReflection),Reflection.prototype.HasOneReflection=function(_super){function HasOneReflection(){return _ref1=HasOneReflection.__super__.constructor.apply(this,arguments)}return __extends(HasOneReflection,_super),HasOneReflection.__excludeFromExtend=!0,HasOneReflection.prototype.macro="hasOne",HasOneReflection.prototype.hasOne=function(){return!0},HasOneReflection.prototype.associationClass=function(){return ActiveResource.prototype.Associations.prototype.HasOneAssociation},HasOneReflection}(Reflection.prototype.AbstractReflection),Reflection.prototype.BelongsToReflection=function(_super){function BelongsToReflection(){return _ref2=BelongsToReflection.__super__.constructor.apply(this,arguments)}return __extends(BelongsToReflection,_super),BelongsToReflection.__excludeFromExtend=!0,BelongsToReflection.prototype.macro="belongsTo",BelongsToReflection.prototype.belongsTo=function(){return!0},BelongsToReflection.prototype.constructable=function(){return!this.polymorphic()},BelongsToReflection.prototype.associationClass=function(){return this.polymorphic()?ActiveResource.prototype.Associations.prototype.BelongsToPolymorphicAssociation:ActiveResource.prototype.Associations.prototype.BelongsToAssociation},BelongsToReflection}(Reflection.prototype.AbstractReflection),Reflection}.call(this)}.call(this),function(){var __slice=[].slice;ActiveResource.prototype.Relation=function(){function Relation(base,__queryOptions){this.base=base,this.__queryOptions=__queryOptions,this.queryName=this.base.queryName}return ActiveResource.include(Relation,ActiveResource.prototype.Typing),Relation.prototype.links=function(){return this.base.links()},Relation.prototype.where=function(options){return this.__newRelation(this.__extendObjectParam("filter",options))},Relation.prototype.order=function(args){return this.__newRelation(this.__extendObjectParam("sort",args))},Relation.prototype.select=function(){var args,queryOptions,_this=this;return args=1<=arguments.length?__slice.call(arguments,0):[],queryOptions=_.clone(this.__queryOptions||{}),queryOptions.fields||(queryOptions.fields={}),ActiveResource.prototype.Collection.build(args).map(function(a){var key,_i,_len,_ref,_results;if(_.isObject(a)){for(_ref=_.keys(a),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],_results.push(_.pick(a,key));return _results}return a}).flatten().each(function(arg){var modelName;return modelName=_.isObject(arg)?_.keys(arg)[0]:_this.queryName,queryOptions.fields=_this.__extendArrayParam(modelName,_.isObject(arg)?[_.values(arg)[0]]:[arg],queryOptions.fields)}),this.__newRelation(queryOptions)},Relation.prototype.page=function(value){return this.__newRelation(this.__extendObjectParam("page",{number:value}))},Relation.prototype.per=function(value){return this.__newRelation(this.__extendObjectParam("page",{size:value}))},Relation.prototype.includes=function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],args=ActiveResource.prototype.Collection.build(args).map(function(a){var key,_i,_len,_ref,_results;if(_.isObject(a)){for(_ref=_.keys(a),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],_results.push(_.pick(a,key));return _results}return a}).flatten().toArray(),this.__newRelation(this.__extendArrayParam("include",args))},Relation.prototype.build=function(attributes){var resource,_ref;return null==attributes&&(attributes={}),resource=null!=this.base?new this.base:new this,resource.assignAttributes(_.extend(attributes,null!=(_ref=this.__queryOptions)?_ref.filter:void 0)),resource},Relation.prototype.create=function(attributes,callback){return null==attributes&&(attributes={}),this.build(attributes).save(callback)},Relation.prototype.find=function(primaryKey){return null!=primaryKey?ActiveResource["interface"].get(this.links().related+primaryKey.toString(),this.__queryOptions):void 0},Relation.prototype.findBy=function(conditions){return this.where(conditions).first()},Relation.prototype.all=function(){return ActiveResource["interface"].get(this.links().related,this.__queryOptions)},Relation.prototype.each=function(iteratee){return this.all().then(function(collection){return collection.each(iteratee),collection})},Relation.prototype.first=function(n){var relation;return relation=null!=(this.__queryOptions||(this.__queryOptions={})).page?this:this.per(n||1),relation.all().then(function(collection){return collection.first(n)})},Relation.prototype.last=function(n){var relation;return relation=null!=(this.__queryOptions||(this.__queryOptions={})).page?this:this.page(-1).per(n||1),relation.all().then(function(collection){return collection.last(n)})},Relation.prototype.__newRelation=function(queryOptions){return new this.constructor(this.base,queryOptions)},Relation.prototype.__extendObjectParam=function(param,options,queryOptions){return queryOptions||(queryOptions=_.clone(this.__queryOptions||{})),queryOptions[param]=_.extend(queryOptions[param]||{},options),queryOptions},Relation.prototype.__extendArrayParam=function(param,items,queryOptions){var _ref;return queryOptions||(queryOptions=_.clone(this.__queryOptions||{})),queryOptions[param]||(queryOptions[param]=[]),null!=items&&(_ref=queryOptions[param]).push.apply(_ref,items),queryOptions},Relation}()}.call(this),function(){ActiveResource.prototype.Base=function(){
function Base(){}return ActiveResource.extend(Base,ActiveResource.prototype.Associations),ActiveResource.extend(Base,ActiveResource.prototype.Reflection.prototype),ActiveResource.extend(Base,ActiveResource.prototype.Relation),ActiveResource.extend(Base,ActiveResource.prototype.Relation.prototype),ActiveResource.include(Base,ActiveResource.prototype.Associations.prototype),ActiveResource.include(Base,ActiveResource.prototype.Attributes),ActiveResource.include(Base,ActiveResource.prototype.Errors),ActiveResource.include(Base,ActiveResource.prototype.Persistence),ActiveResource.include(Base,ActiveResource.prototype.Typing),Base.queryName="",Base.className="",Base.primaryKey="id",Base.links=function(){if(null==ActiveResource.baseUrl)throw"ActiveResource.baseUrl is not set";return this.__links||(this.__links={related:ActiveResource.baseUrl+this.queryName+"/"})},Base.prototype.links=function(){return this.__links||(this.__links=this.klass().links())},Base.__newRelation=function(queryOptions){return new ActiveResource.prototype.Relation(this,queryOptions)},Base}()}.call(this),function(){ActiveResource.prototype.Associations.prototype.Association=function(){function Association(owner,reflection){this.owner=owner,this.reflection=reflection,this.reset()}return ActiveResource.include(Association,ActiveResource.prototype.Typing),Association.__excludeFromExtend=!0,Association.prototype.klass=function(){return this.reflection.klass()},Association.prototype.options=function(){return this.reflection.options},Association.prototype.links=function(){return this.__links||(this.__links=this.klass().links())},Association.prototype.reset=function(){return this.__loaded=!1,this.target=null},Association.prototype.reload=function(){var _this;return this.reset(),_this=this,this.loadTarget().then(function(){return _this})},Association.prototype.loaded=function(set){return null==set&&(set=!1),set&&(this.__loaded=!0),this.__loaded},Association.prototype.loadTarget=function(){var _this;return this.__canFindTarget()?(_this=this,this.__findTarget().then(function(loadedTarget){return _this.target=loadedTarget,_this.loaded(!0),loadedTarget}).fail(function(){return _this.reset()})):(this.reset(),$.when(null))},Association.prototype.setInverseInstance=function(resource){var inverse;return this.__invertibleFor(resource)&&(inverse=resource.association(this.__inverseReflectionFor(resource).name),inverse.target=this.owner),resource},Association.prototype.__raiseOnTypeMismatch=function(resource){if(!("function"==typeof resource.isA?resource.isA(this.reflection.klass()):void 0))throw""+this.reflection.className()+" expected, got "+resource+" which is an instance of "+resource.constructor},Association.prototype.__canFindTarget=function(){return(!this.owner.newResource()||this.__foreignKeyPresent())&&this.klass()},Association.prototype.__creationAttributes=function(){var attributes,_base,_base1;return attributes={},(("function"==typeof(_base=this.reflection).hasOne?_base.hasOne():void 0)||("function"==typeof(_base1=this.reflection).collection?_base1.collection():void 0))&&(attributes[this.reflection.foreignKey()]=this.owner[this.reflection.activeResourcePrimaryKey()],this.reflection.options.as&&(attributes[this.reflection.type()]=this.owner.klass().className)),attributes},Association.prototype.__setOwnerAttributes=function(resource){var key,value,_ref,_results;_ref=this.__creationAttributes(),_results=[];for(key in _ref)value=_ref[key],_results.push(resource[key]=value);return _results},Association.prototype.__foreignKeyPresent=function(){return!1},Association.prototype.__inverseReflectionFor=function(resource){return this.reflection.inverseOf()},Association.prototype.__invertibleFor=function(resource){return this.__foreignKeyFor(resource)&&this.__inverseReflectionFor(resource)},Association.prototype.__foreignKeyFor=function(resource){return"function"==typeof resource.hasAttribute?resource.hasAttribute(this.reflection.foreignKey()):void 0},Association.prototype.__buildResource=function(attributes){var resource;return resource=this.reflection.buildAssociation(),resource.assignAttributes(attributes),resource},Association}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.CollectionAssociation=function(_super){function CollectionAssociation(owner,reflection){this.owner=owner,this.reflection=reflection,this.queryName=this.klass().queryName,CollectionAssociation.__super__.constructor.apply(this,arguments)}return __extends(CollectionAssociation,_super),CollectionAssociation.prototype.reader=function(){return this.proxy||(this.proxy=new ActiveResource.prototype.Associations.prototype.CollectionProxy(this))},CollectionAssociation.prototype.writer=function(resources,save){var persistAssignment,persistedResources,_base,_this=this;return null==save&&(save=!0),resources=ActiveResource.prototype.Collection.build(resources),resources.each(function(r){return _this.__raiseOnTypeMismatch(r)}),persistAssignment=save&&!("function"==typeof(_base=this.owner).newResource?_base.newResource():void 0)&&(persistedResources=resources.select(function(r){return"function"==typeof r.persisted?r.persisted():void 0})).size()?this.__persistAssignment(persistedResources.toArray()):$.when(resources),_this=this,persistAssignment.then(function(){return save&&_this.loaded(!0),_this.replace(resources)})},CollectionAssociation.prototype.concat=function(resources){var persistConcat,persistedResources,_base,_this=this;return resources=ActiveResource.prototype.Collection.build(resources),resources.each(function(r){return _this.__raiseOnTypeMismatch(r)}),persistConcat=!("function"==typeof(_base=this.owner).newResource?_base.newResource():void 0)&&(persistedResources=resources.select(function(r){return"function"==typeof r.persisted?r.persisted():void 0})).size()?this.__persistConcat(persistedResources.toArray()):$.when(resources),_this=this,persistConcat.then(function(){return _this.__concatResources(resources)})},CollectionAssociation.prototype["delete"]=function(resources){var persistDelete,persistedResources,_base,_this=this;return resources=ActiveResource.prototype.Collection.build(resources),resources.each(function(r){return _this.__raiseOnTypeMismatch(r)}),persistDelete=!("function"==typeof(_base=this.owner).newResource?_base.newResource():void 0)&&(persistedResources=resources.select(function(r){return"function"==typeof r.persisted?r.persisted():void 0})).size()?this.__persistDelete(persistedResources.toArray()):$.when(resources),_this=this,persistDelete.then(function(){return _this.__removeResources(resources)})},CollectionAssociation.prototype.reset=function(){return CollectionAssociation.__super__.reset.apply(this,arguments),this.target=ActiveResource.prototype.Collection.build()},CollectionAssociation.prototype.addToTarget=function(resource){var index;return index=_.indexOf(this.target.toArray(),resource),0>index&&(index=null),this.replaceOnTarget(resource,index)},CollectionAssociation.prototype.replaceOnTarget=function(resource,index){return null!=index?this.target.set(index,resource):this.target.push(resource),this.setInverseInstance(resource),resource},CollectionAssociation.prototype.empty=function(){return this.target.empty()},CollectionAssociation.prototype.build=function(attributes){var _this=this;return null==attributes&&(attributes={}),_.isArray(attributes)?_.map(attributes,function(attr){return _this.build(attr)}):this.__concatResources(ActiveResource.prototype.Collection.build(this.__buildResource(attributes))).first()},CollectionAssociation.prototype.create=function(attributes,queryOptions,callback){return null==attributes&&(attributes={}),null==queryOptions&&(queryOptions={}),null==callback&&(callback=_.noop()),this.__createResource(attributes,queryOptions,callback)},CollectionAssociation.prototype.__findTarget=function(){var _this;return _this=this,ActiveResource["interface"].get(this.links().related).then(function(resources){return resources.each(function(r){return _this.setInverseInstance(r)}),resources})},CollectionAssociation.prototype.replace=function(other){return this.__removeResources(this.target),this.__concatResources(other)},CollectionAssociation.prototype.__concatResources=function(resources){var _this=this;return resources.each(function(resource){return _this.addToTarget(resource),_this.insertResource(resource)}),resources},CollectionAssociation.prototype.__removeResources=function(resources){return this.__deleteResources(resources)},CollectionAssociation.prototype.__deleteResources=function(resources){throw"__deleteResources not implemented on CollectionAssociation"},CollectionAssociation.prototype.__persistAssignment=function(resources){return ActiveResource["interface"].patch(this.links().self,resources,{onlyResourceIdentifiers:!0})},CollectionAssociation.prototype.__persistConcat=function(resources){return ActiveResource["interface"].post(this.links().self,resources,{onlyResourceIdentifiers:!0})},CollectionAssociation.prototype.__persistDelete=function(resources){return ActiveResource["interface"]["delete"](this.links().self,resources,{onlyResourceIdentifiers:!0})},CollectionAssociation.prototype.__createResource=function(attributes,queryOptions,callback){var resource,_base,_this;if(!("function"==typeof(_base=this.owner).persisted?_base.persisted():void 0))throw"You cannot call create unless the parent is saved";return resource=this.__buildResource(attributes),resource.__queryOptions=_.pick(queryOptions,"fields","include"),this.insertResource(resource),_this=this,resource.save(callback).then(function(){return _this.addToTarget(resource)})},CollectionAssociation}(ActiveResource.prototype.Associations.prototype.Association)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.CollectionProxy=function(_super){function CollectionProxy(){return _ref=CollectionProxy.__super__.constructor.apply(this,arguments)}return __extends(CollectionProxy,_super),CollectionProxy.__excludeFromExtend=!0,CollectionProxy.prototype.target=function(){return this.base.target},CollectionProxy.prototype.all=function(options){return null==options&&(options={}),options.cached?this.target():CollectionProxy.__super__.all.apply(this,arguments)},CollectionProxy.prototype.toArray=function(){return this.all({cached:!0}).toArray()},CollectionProxy.prototype.size=function(){return this.target().size()},CollectionProxy.prototype.empty=function(){return this.target().empty()},CollectionProxy.prototype.assign=function(other,save){return null==save&&(save=!0),this.base.writer(other,save)},CollectionProxy.prototype.push=function(resources){return this.base.concat(resources)},CollectionProxy.prototype.build=function(attributes){var _ref1,_this=this;return null==attributes&&(attributes={}),attributes=_.isArray(attributes)?_.map(attributes,function(attr){var _ref1;return _.extend(attr,null!=(_ref1=_this.__queryOptions)?_ref1.filter:void 0)}):_.extend(attributes,null!=(_ref1=this.__queryOptions)?_ref1.filter:void 0),this.base.build(attributes)},CollectionProxy.prototype.create=function(attributes,callback){var _ref1;return null==attributes&&(attributes={}),this.base.create(_.extend(attributes,null!=(_ref1=this.__queryOptions)?_ref1.filter:void 0),this.__queryOptions,callback)},CollectionProxy.prototype.reload=function(){return this.base.reload()},CollectionProxy.prototype["delete"]=function(resources){return this.base["delete"](resources)},CollectionProxy.prototype.deleteAll=function(){return this.base["delete"](this.target())},CollectionProxy}(ActiveResource.prototype.Relation)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.HasManyAssociation=function(_super){function HasManyAssociation(){return _ref=HasManyAssociation.__super__.constructor.apply(this,arguments)}return __extends(HasManyAssociation,_super),HasManyAssociation.prototype.insertResource=function(resource){return this.__setOwnerAttributes(resource),this.setInverseInstance(resource)},HasManyAssociation.prototype.__deleteResources=function(resources){var _this=this;return resources.each(function(resource){var inverse;return null!=(inverse=_this.reflection.inverseOf())?resource.association(inverse.name).replace(null):resource[_this.reflection.foreignKey()]=null}),this.target=ActiveResource.prototype.Collection.build(_.difference(this.target.toArray(),resources.toArray()))},HasManyAssociation}(ActiveResource.prototype.Associations.prototype.CollectionAssociation)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.SingularAssociation=function(_super){function SingularAssociation(){return _ref=SingularAssociation.__super__.constructor.apply(this,arguments)}return __extends(SingularAssociation,_super),SingularAssociation.prototype.reader=function(){return this.target},SingularAssociation.prototype.writer=function(resource,save){var persistResource,_base,_this;return null==save&&(save=!0),null!=resource&&this.__raiseOnTypeMismatch(resource),persistResource=save&&!("function"==typeof(_base=this.owner).newResource?_base.newResource():void 0)?this.__persistAssignment(resource):$.when(resource),_this=this,persistResource.then(function(){return save&&_this.loaded(!0),_this.replace(resource)})},SingularAssociation.prototype.build=function(attributes){var resource;return null==attributes&&(attributes={}),resource=this.__buildResource(attributes),this.replace(resource),resource},SingularAssociation.prototype.create=function(attributes,callback){return null==attributes&&(attributes={}),this.__createResource(attributes,callback)},SingularAssociation.prototype.replace=function(resource){return raise("Subclasses must implement a __replace(resource) method")},SingularAssociation.prototype.__persistAssignment=function(resource){return ActiveResource["interface"].patch(this.links().self,resource,{onlyResourceIdentifiers:!0})},SingularAssociation.prototype.__getResource=function(){return ActiveResource["interface"].get(this.links().related)},SingularAssociation.prototype.__findTarget=function(){var _this;return _this=this,this.__getResource().then(function(resource){return _this.setInverseInstance(resource)})},SingularAssociation.prototype.__createResource=function(attributes,callback){var resource,_this;return resource=this.__buildResource(attributes),this.replace(resource),_this=this,resource.save(callback).then(function(){return _this.loaded(!0),resource})},SingularAssociation}(ActiveResource.prototype.Associations.prototype.Association)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.HasOneAssociation=function(_super){function HasOneAssociation(){return _ref=HasOneAssociation.__super__.constructor.apply(this,arguments)}return __extends(HasOneAssociation,_super),HasOneAssociation.prototype.replace=function(resource){return this.__removeTarget(),resource?(this.__setOwnerAttributes(resource),this.setInverseInstance(resource),this.target=resource):void 0},HasOneAssociation.prototype.__removeTarget=function(){return this.target&&this.__nullifyOwnerAttributes(this.target),this.target=null},HasOneAssociation.prototype.__nullifyOwnerAttributes=function(resource){return resource[this.reflection.foreignKey()]=null},HasOneAssociation}(ActiveResource.prototype.Associations.prototype.SingularAssociation)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.BelongsToAssociation=function(_super){function BelongsToAssociation(){return _ref=BelongsToAssociation.__super__.constructor.apply(this,arguments)}return __extends(BelongsToAssociation,_super),BelongsToAssociation.prototype.reset=function(){return BelongsToAssociation.__super__.reset.apply(this,arguments),this.updated=!1},BelongsToAssociation.prototype.replace=function(resource){return resource?(this.__replaceKeys(resource),this.setInverseInstance(resource),this.updated=!0):this.__removeKeys(),this.target=resource},BelongsToAssociation.prototype.__getResource=function(){return this.owner.newResource()?ActiveResource["interface"].get(this.links().related+this.owner[this.reflection.foreignKey()]):BelongsToAssociation.__super__.__getResource.apply(this,arguments)},BelongsToAssociation.prototype.__replaceKeys=function(resource){return this.owner[this.reflection.foreignKey()]=resource.__readAttribute(this.reflection.associationPrimaryKey(resource.klass()))},BelongsToAssociation.prototype.__removeKeys=function(){return this.owner[this.reflection.foreignKey()]=null},BelongsToAssociation.prototype.__foreignKeyPresent=function(){return null!=this.owner.__readAttribute(this.reflection.foreignKey())},BelongsToAssociation.prototype.__invertibleFor=function(resource){var inverse;return inverse=this.__inverseReflectionFor(resource),inverse&&("function"==typeof inverse.hasOne?inverse.hasOne():void 0)},BelongsToAssociation}(ActiveResource.prototype.Associations.prototype.SingularAssociation)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.BelongsToPolymorphicAssociation=function(_super){function BelongsToPolymorphicAssociation(){return _ref=BelongsToPolymorphicAssociation.__super__.constructor.apply(this,arguments)}return __extends(BelongsToPolymorphicAssociation,_super),BelongsToPolymorphicAssociation.prototype.klass=function(){var type;return type=this.owner[this.reflection.foreignType()],ActiveResource.constantize(type)},BelongsToPolymorphicAssociation.prototype.__replaceKeys=function(resource){return BelongsToPolymorphicAssociation.__super__.__replaceKeys.apply(this,arguments),this.owner[this.reflection.foreignType()]=resource.klass().className},BelongsToPolymorphicAssociation.prototype.__removeKeys=function(){return BelongsToPolymorphicAssociation.__super__.__removeKeys.apply(this,arguments),this.owner[this.reflection.foreignType()]=null},BelongsToPolymorphicAssociation.prototype.__inverseReflectionFor=function(resource){return this.reflection.polymorphicInverseOf(resource.klass())},BelongsToPolymorphicAssociation.prototype.__raiseOnTypeMismatch=function(resource){},BelongsToPolymorphicAssociation}(ActiveResource.prototype.Associations.prototype.BelongsToAssociation)}.call(this),function(){ActiveResource.prototype.Associations.prototype.Builder=function(){function Builder(){}return Builder.__excludeFromExtend=!0,Builder.prototype.Association=function(){function Association(){}return Association.build=function(model,name,options){var reflection;return reflection=ActiveResource.prototype.Reflection.create(this.macro,name,options,model),this.defineAccessors(model,reflection),reflection},Association.defineAccessors=function(model,reflection){var name;return name=reflection.name,this.defineReaders(model,name),this.defineWriters(model,name)},Association.defineReaders=function(mixin,name){return mixin.prototype[name]=function(){return this.association(name).reader()},mixin.prototype["load"+s.capitalize(name)]=function(){return this.association(name).loadTarget()}},Association.defineWriters=function(mixin,name){return _.noop()},Association}(),Builder}.call(this)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.Builder.prototype.CollectionAssociation=function(_super){function CollectionAssociation(){return _ref=CollectionAssociation.__super__.constructor.apply(this,arguments)}return __extends(CollectionAssociation,_super),CollectionAssociation}(ActiveResource.prototype.Associations.prototype.Builder.prototype.Association)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.Builder.prototype.HasMany=function(_super){function HasMany(){return _ref=HasMany.__super__.constructor.apply(this,arguments)}return __extends(HasMany,_super),HasMany.macro="hasMany",HasMany}(ActiveResource.prototype.Associations.prototype.Builder.prototype.CollectionAssociation)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.Builder.prototype.SingularAssociation=function(_super){function SingularAssociation(){return _ref=SingularAssociation.__super__.constructor.apply(this,arguments)}return __extends(SingularAssociation,_super),SingularAssociation.defineAccessors=function(model,reflection){return SingularAssociation.__super__.constructor.defineAccessors.apply(this,arguments),("function"==typeof reflection.constructable?reflection.constructable():void 0)?this.defineConstructors(model,reflection.name):void 0},SingularAssociation.defineWriters=function(mixin,name){return mixin.prototype["assign"+s.capitalize(name)]=function(value){return this.association(name).writer(value,!1)},mixin.prototype["update"+s.capitalize(name)]=function(value){return this.association(name).writer(value)}},SingularAssociation.defineConstructors=function(mixin,name){return mixin.prototype["build"+s.capitalize(name)]=function(attributes){return this.association(name).build(attributes)},mixin.prototype["create"+s.capitalize(name)]=function(attributes,callback){return this.association(name).create(attributes,callback)}},SingularAssociation}(ActiveResource.prototype.Associations.prototype.Builder.prototype.Association)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.Builder.prototype.BelongsTo=function(_super){function BelongsTo(){return _ref=BelongsTo.__super__.constructor.apply(this,arguments)}return __extends(BelongsTo,_super),BelongsTo.macro="belongsTo",BelongsTo}(ActiveResource.prototype.Associations.prototype.Builder.prototype.SingularAssociation)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ActiveResource.prototype.Associations.prototype.Builder.prototype.HasOne=function(_super){function HasOne(){return _ref=HasOne.__super__.constructor.apply(this,arguments)}return __extends(HasOne,_super),HasOne.macro="hasOne",HasOne}(ActiveResource.prototype.Associations.prototype.Builder.prototype.SingularAssociation)}.call(this),ActiveResource});